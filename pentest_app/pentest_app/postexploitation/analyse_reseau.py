# Analyse du réseau interne
from scapy.all import ARP, Ether, srp
import subprocess

def analyse_reseau_interne(target_subnet, outil="scapy", progress_callback=None):
    def log(msg):
        if progress_callback:
            progress_callback(msg)
        else:
            print(msg)
    log(f"Analyse du réseau interne sur {target_subnet} avec l'outil : {outil}")
    if outil == "scapy":
        pkt = Ether(dst="ff:ff:ff:ff:ff:ff")/ARP(pdst=target_subnet)
        ans, _ = srp(pkt, timeout=2, verbose=0)
        if ans:
            for snd, rcv in ans:
                log(f"IP: {rcv.psrc}, MAC: {rcv.hwsrc}")
        else:
            log("Aucune machine détectée sur le réseau.")
        log("Analyse terminée.")
    elif outil == "suricata":
        log("Analyse réseau avec Suricata...")
        try:
            result = subprocess.run(["suricata", "-r", target_subnet], capture_output=True, text=True)
            log(result.stdout)
        except Exception as e:
            log(f"Erreur lors de l'exécution de Suricata : {e}")
    elif outil == "metasploit":
        log("Analyse réseau avec Metasploit (nécessite Metasploit installé et configuré)")
        log("Veuillez lancer le module Metasploit adapté (ex: auxiliary/scanner/discovery/arp_sweep) via msfconsole ou l'API.")
        # Pour une intégration avancée, il faudrait utiliser l'API Metasploit
    else:
        log("Outil non reconnu. Utilisez 'scapy', 'suricata' ou 'metasploit'.")
