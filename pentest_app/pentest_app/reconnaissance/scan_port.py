# Scan de port avec scapy et nmap
import subprocess
from scapy.all import *

def scan_ports(target, ports, use_nmap=False):
    if use_nmap:
        print(f"Scan de ports avec nmap sur {target}...")
        ports_str = ','.join(str(p) for p in ports)
        try:
            result = subprocess.run(["nmap", "-p", ports_str, target], capture_output=True, text=True)
            print(result.stdout)
        except Exception as e:
            print(f"Erreur lors de l'exécution de nmap : {e}")
    else:
        print(f"Scan de ports avec scapy sur {target}...")
        for port in ports:
            pkt = IP(dst=target)/TCP(dport=port,flags="S")
            resp = sr1(pkt, timeout=1, verbose=0)
            if resp and resp.haslayer(TCP) and resp[TCP].flags == 0x12:
                print(f"Port {port} ouvert")
            else:
                print(f"Port {port} fermé ou filtré")
