# Évasion IDS
from scapy.all import IP, TCP, Raw, send
import base64

def IDS_evasion(target, progress_callback=None):
    msg = f"Tentative d'évasion IDS sur {target}"
    if progress_callback:
        progress_callback(msg)
    else:
        print(msg)
    # Envoi d'un payload encodé (exemple)
    payload = "GET /index.html HTTP/1.1\r\nHost: " + target + "\r\n\r\n"
    encoded_payload = base64.b64encode(payload.encode())
    pkt = IP(dst=target)/TCP(dport=80)/Raw(load=encoded_payload)
    send(pkt, verbose=0)
    msg = "Payload encodé envoyé. Vérifiez la détection IDS."
    if progress_callback:
        progress_callback(msg)
    else:
        print(msg)
