// Centralized Socket.IO test runner for all test pages
var socket = io();
function launchTest(event, formId, eventName, dataFields, terminalId) {
    event.preventDefault();
    var data = {};
    var form = formId ? document.getElementById(formId) : document;
    var missing = [];
    dataFields.forEach(function(field) {
        var el = document.getElementById(field);
        if (!el && form) {
            el = form.querySelector('[name="' + field + '"]');
        }
        if (el) {
            if (el.type === 'checkbox') {
                data[field] = el.checked;
            } else {
                data[field] = (el.value || '').trim();
            }
            if (el.required && (data[field] === '' || data[field] === null || data[field] === undefined)) {
                missing.push(field);
            }
        }
    });
    var terminal = document.getElementById(terminalId);
    terminal.innerHTML = '';
    if (missing.length > 0) {
        typeWriter('Champs requis manquants: ' + missing.join(', '));
        return;
    }
    socket.emit(eventName, data);
}
socket.on('log', function(data) {
    typeWriter(data.msg);
});
socket.on('end', function(data) {
    typeWriter(data.msg);
});
function typeWriter(text) {
    let term = document.getElementById('terminal');
    let i = 0;
    let line = document.createElement('div');
    term.appendChild(line);
    function printChar() {
        if (i < text.length) {
            line.innerHTML += text.charAt(i);
            i++;
            setTimeout(printChar, 10);
        }
    }
    printChar();
}
